\subsection{Expression Serialization}
\label{sec:ser:expr}

Expressions of \langname are serialized as tree data structure using recursive
procedure described in Figure~\ref{fig:ser:expr}. Expression nodes are represented in
the reference implementation using \lst{Value} class.

\begin{figure}[h] \footnotesize
\caption{\lst{Expr} serialization format}\vspace{-7pt}
\label{fig:ser:expr}
\(\begin{tabularx}{\textwidth}{| l | l | l | X |}
    \hline
    \bf{Slot} & \bf{Format} & \bf{\#bytes} & \bf{Description} \\
    \hline
    \multicolumn{4}{l}{\lst{def serializeExpr(}$e$\lst{)}} \\
    \hline
    ~~$e.opCode$  & \lst{Byte} & $1$ & opcode of ErgoTree node, 
    used for selection of an appropriate node serializer from Appendix~\ref{sec:appendix:ergotree_serialization} \\
    \hline
    \multicolumn{4}{l}{~~\lst{if} $opCode <= $ \lst{LastConstantCode then}} \\
    \hline
    ~~~~$c$  & \lst{Constant} & $[1..\MaxConstSize]$ & Constant serializaton according to~\ref{sec:ser:const} \\ 
    \hline
    \multicolumn{4}{l}{~~\lst{else}} \\
    \hline
    ~~~~$body$  & \lst{Op} & $[1..\MaxExprSize]$ & serialization of the operation 
    depending on $e.opCode$ as defined in Appendix~\ref{sec:appendix:ergotree_serialization} \\ 
    \hline
    \multicolumn{4}{l}{~~\lst{end if}} \\
    \multicolumn{4}{l}{\lst{end serializeExpr}} \\
    \hline
    \hline
\end{tabularx}\)
\end{figure}
